#!/usr/bin/env node

var gmDirname	= process.env.HOME+"/.js/greasemonkey";
var gmBaseNames	= require('fs').readdirSync(gmDirname).filter(function(value){
	return value.match(/\.user\.js$/);
});


gmBaseNames.forEach(function(gmBaseName){
	var filename	= gmDirname+"/"+gmBaseName;
	var opts	= require('./node-greasemonkey.js').parseFile(filename)
	console.log(gmBaseName, opts)
})


var http = require('http');
http.createServer(function (req, res) {
	var parsedUrl	= require('url').parse(req.url)
	var filename	= process.env.HOME+"/.js/"+parsedUrl.pathname.substring(1);
	try {
		var content	= require('fs').readFileSync(filename);
	}catch (e) {}
	res.writeHead(content ? 200 : 204, {
		'Access-Control-Allow-Origin'	: '*',
		'Control-Type'			: 'text/javascript'
	});
	res.end(content);
}).listen(3131, "127.0.0.1");

console.log('Server running at http://127.0.0.1:8124/');